---
layout: default
search_title: "IRIDA MiSeq Uploader"
description: "Guide for running the IRIDA MiSeq uploader."
---

This document describes how the IRIDA data uploader for the Illumina MiSeq instrument can be used.

* This comment becomes the table of contents
{:toc}

Overview
========
The IRIDA MiSeq Uploader is to be used in conjunction with an IRIDA REST API to store newly run MiSeq sequencing runs in a repository.  The uploader will scan a directory of MiSeq runs, scan the `SampleSheet.csv` file to collect information about the run, then upload the files to the REST API.

The uploader can be run in a single directory mode which will upload individual MiSeq run directories, or in a scanning mode which will look for directories that have not been previously uploaded then send them to the API.

When a directory completes uploading, it will be marked with a `.miseqUploaderComplete` file that prevents it from being uploaded twice when using the scanning mode.

Running IRIDA MiSeq Uploader
============================

Arguments
---------

* `-b,--base-url [ARG]`
  Base IRIDA REST API URL (required)

* `-u,--username [ARG]`
  Username for IRIDA REST API

* `-p,--password [ARG]`
  Password for IRIDA REST API (optional, if not specified you will be interactively prompted to enter your password)

* `--project [ARG]`
  Project ID to upload a directory of files to.  This option will override the
 project ID in a MiSeq run `SampleSheet.csv` file.  (Optional)

* `-s,--scan [ARG]`
  Directory to scan for new MiSeq runs.  This option enables the directory scanning mode.

* `-v,--verbose`
  Prints more information about each request

* `-h,--help`
  Print help documentation

Configuration File
------------------
The IRIDA MiSeq Uploader requires client authentication details to connect to the IRIDA server. You must first [create a client](../../../user/administrator/#creating-a-new-system-client) and note the client ID that you used, and the client secret that was generated by the server.

Create a file in the same directory as a the IRIDA MiSeq Uploader `jar` file named `irida-tools.properties` with the following keys (replacing the values with the values that you noted in the last step):

```properties
oauth.client_id=clientId
oauth.client_secret=clientSecret
```

You **must** create this file before attempting to upload to the server, otherwise the client will not be able to authenticate with the server.

Usage Examples
--------------

### Upload a single MiSeq directory

To upload a single MiSeq directory you must provide the application with the path to the REST API and path to the directory you want to upload.

```bash
java -jar irida-tools.jar miseq-upload -b http://irida.ca/api --username test_user --password test_password /path/to/example_data/example_run
Uploading directory /path/to/example_data/example_run
Created Miseq Run at http://irida.ca/miseqrun/1
Created sample http://irida.ca/projects/1/samples/6
Created sample http://irida.ca/projects/1/samples/7
Created sample http://irida.ca/projects/1/samples/8
...
sent file1_1.fastq.gz to http://irida.ca/projects/1/samples/28/sequenceFiles/1
sent file1_2.fastq.gz to http://irida.ca/projects/1/samples/24/sequenceFiles/2
sent file2_1.fastq.gz to http://irida.ca/projects/1/samples/22/sequenceFiles/3
...
Marking directory /path/to/example_data/example_run completed.
```

### Upload multiple directories

Uploading multiple directories functions exactly like uploading a single directory.  A user is able to specify multiple directories to be uploaded at once using the same username, password, and REST API URL.

```bash
java -jar irida-tools.jar miseq-upload -b http://irida.ca/api --username test_user --password test_password /path/to/example_data/example_run /path/to/example_data/another_run
```

### Upload all new MiSeq directories

To upload all new MiSeq directories that haven't been uploaded before, you must use the scan (-s or --scan) option.  This will look for directories that haven't been marked with a `.miseqUploaderComplete` file and append them to the list to be uploaded.

```bash
java -jar irida-tools.jar miseq-upload -b http://irida.ca/api --username test_user --password test_password --scan /path/to/example_data/
Checking /path/to/example_data/data1
Adding directory for upload: /path/to/example_data/data1
Checking /path/to/example_data/data2
Adding directory for upload: /path/to/example_data/data2
Checking /path/to/example_data/data
Adding directory for upload: /path/to/example_data/data
Uploading directory /path/to/example_data/data1
Created Miseq Run at http://irida.ca/miseqrun/1
Created sample http://irida.ca/projects/4/samples/6
Created sample http://irida.ca/projects/4/samples/7
Created sample http://irida.ca/projects/4/samples/8
...
sent file1_1.fastq.gz to http://irida.ca/projects/4/samples/6/sequenceFiles/1
sent file1_2.fastq.gz to http://irida.ca/projects/4/samples/14/sequenceFiles/2
sent file2_1.fastq.gz to http://irida.ca/projects/4/samples/11/sequenceFiles/3
...
Marking /path/to/example_data/data1 completed.
```

Errors and Warnings
-------------------

* `/path/to/example_data/Data/Intensities/BaseCalls/Undetermined_S0_L001_R2_001.fastq.gz: Sample named Undetermined doesn't exist in sample worksheet.  Skipping file.`
    Some MiSeq runs have a file named *Undetermined* in the BaseCalls directory.  This file is produced when there are reads that are unable to be placed in a sample.  This file is ignored because it cannot be associatd with a sample or project.

* `warning: directory /path/to/example_data is not a valid MiSeq directory, skipping...`
    The directory was not able to be parsed as a valid MiSeq directory.  It may not have a `SampleSheet.csv` file.
