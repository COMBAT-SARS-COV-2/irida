<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="template/page">
<head>
<title th:text="${group.label}">_IRIDA Group_</title>

<script th:inline="javascript">
	var PAGE = {
		urls : {
			addMember : /*[[@{/groups/{id}/members(id=${group.getId()})}]]*/'/groups/1/members',
			removeMember : /*[[@{/groups/{id}/members/(id=${group.getId()})}]]*/'/groups/1/members',
			table : /*[[@{/groups/{id}/ajax/list(id=${group.id})}]]*/'/groups/1/ajax/list',
			usersLink : /*[[@{/users/}]]*/'/users',
			usersSelection : /*[[@{/groups/{id}/ajax/availablemembers(id=${group.getId()})}]]*/'/groups/1/ajax/availablemembers'
		},
		i18n : {
			'GROUP_OWNER' : /*[[#{group.users.role.GROUP_OWNER}]]*/'_Group owner_',
			'GROUP_MEMBER' : /*[[#{group.users.role.GROUP_MEMBER}]]*/'_Group member_',
			'unexpectedAddError' : /*[[#{group.users.add.notification.failure}]]*/'_An error happened when adding the user to this group, try again_',
			'unexpectedRemoveError' : /*[[#{group.users.remove.notification.failure}]]*/'_An error happened when removing the user from this group, try again_'
		}
	};
</script>
</head>
<body>
	<main layout:fragment="page" ddl:bundle-includes="group-members"
		ddl:asset-css-excludes="jquery.datatables">
	<div dt:conf="groupMembersTable">
		<div dt:confType="callback" dt:type="createdRow" dt:function="group-members#groupMembersTable.deleteLinkCallback" />
	</div>
	<div class="col-md-12">
		<div class="row">
			<div class="col-md-12">
				<h1 id="wb-cont" class="group-details-title" property="name"
					th:text="${group.label}">__IRIDA Group__</h1>
				<div class="btn-toolbar" style="margin-bottom: 1rem;" role="toolbar">
					<div class="btn-group">
						<button id="add-members-button" class="btn btn-default"
							type="button" data-toggle="modal" data-target="#addUserModal"
							th:if="${isAdmin} or ${isOwner}" href="#addMembersLink"
							th:text="#{group.users.add.button}">_Add
							Members_</button>
					</div>
				</div>
			</div>
			<div class="col-md-12">
				<table id="groupMembersTable" dt:table="true" dt:url="@{/groups/{id}/ajax/list(id=${group.id})}">
					<thead>
					<tr role="row">
						<th dt:property="subject.label" dt:searchable="true" th:text="#{group.users.username}" dt:renderFunction="group-members#groupMembersTable.userNameLinkRow"></th>
						<th dt:property="role" dt:searchable="true" dt:renderFunction="group-members#groupMembersTable.renderGroupRole" th:text="#{group.users.role}"></th>
						<th dt:property="createdDate" dt:renderFunction="datatables-utils#datatable.formatDate" th:text="#{group.users.date.added}"></th>
						<th width="50px" dt:sortable="false" dt:renderFunction="group-members#groupMembersTable.removeUserButton"></th>
					</tr>
					</thead>
				</table>
			</div>
		</div>

	</div>
	
	<div class="modal fade" id="addUserModal" role="dialog" aria-labelledby="#addUserTitle">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" data:aria-label="#{form.btn.close}">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="addUserTitle" th:text="#{group.users.add.modal.title}">_Add User_</h4>					
				</div>
				<div class="modal-body">
	                <div class="form-group">
	                    <label class="control-label" for="add-user-username" th:text="#{group.users.add.user}">_Username_</label>
	                    <input type="hidden" id="add-user-username" name="userId" class="form-control input-full" th:placeholder="#{group.users.add.select-user}"/>
	                </div>
	                <div class="form-group">
	                    <label class="control-label" for="add-user-role" th:text="#{group.users.add.role}">_Group Role_</label>
	                    <select id="add-user-role" class="form-control input-full" name="groupRole">
	                        <option th:each="role : ${groupRoles}"
	                                th:value="${role}"
	                                th:text="#{${'group.users.role.'+role}}">_Role_
	                        </option>
	                    </select>
	                </div>
				</div>
				<div class="modal-footer">
				    <button class="btn btn-default" type="button" data-dismiss="modal" th:text="#{group.users.add.cancel}">_Cancel_</button>
            		<button id="submitAddMember" class="btn btn-primary" type="button" th:text="#{group.users.add.ok}">_OK_</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="removeUserModal" role="dialog" aria-labelledby="#deleteConfirmTitle">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" data:aria-label="#{form.btn.close}">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="deleteConfirmTitle" th:text="#{group.users.remove.modal.title}">_Remove Group Member_</h4>
				</div>
				<div class="modal-body">
					<p th:text="#{group.users.remove.modal.confirm}" />
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{form.btn.close}">_Close_</button>
					<button type="button" class="btn btn-danger" id="remove-user-button" th:text="#{group.users.remove.modal.button.remove}">_Remove User_</button>
				</div>
			</div>
		</div>
	</div>
	</main>
</body>
</html>
