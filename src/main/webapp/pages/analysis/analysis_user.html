<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="template/page">
<head lang="en">
	<meta charset="UTF-8"/>
	<title>My Title Goes Here</title>
	<link rel="stylesheet" href="/resources/css/app.css" th:href="@{/resources/css/app.css}"/>
	<style>
		.ng-cloak {display: none !important;}
		.main-container {
			display: flex;
			flex-direction: row;
			height: 100%;
		}

		.side-nav {
			width: 200px;
			background-color: #101010;
			color: #e0e0e0;
			margin-right: 1rem;
		}

		.content {
			flex-grow: 1;
		}

		.analysis__state {
			border-left: 1rem solid darkslategrey;
		}
		
		.analysis__state--NEW {
			border-color: chartreuse;
		}
		
		.analysis__state--PREPARING {
			border-color: lightblue;
		}

		.analysis__state--PREPARING {
			border-color: deepskyblue;
		}

		.analysis__state--PREPARED {
			border-color: darkslateblue;
		}

		.analysis__state--SUBMITTED {
			border-color: greenyellow;
		}

		.analysis__state--ERROR {
			border-color: red;
		}
	</style>
	<script>window.dependencies = ['irida.analysis.user'];</script>
</head>
<body>
<div layout:fragment="page">
	<div class="main-container">
		<aside class="side-nav">
			<h2>Filter</h2>
		</aside>
		<div class="content ng-cloak" ng-controller="AnalysisController as ctrl">
			<ul class="boards">
				<li class="board" ng-repeat="analysis in ctrl.analyses">
					<a href="#" class="button board_inner row">
						<div ng-class="'analysis__state--' + analysis.analysisState" class="analysis__state col-md-2">{{analysis.analysisState|StateFilter}}</div>
						<div class="col-md-4">
							<div class="board_detail--value">{{analysis.label}}</div>
							<div class="board_detail--desc">Analysis Name</div>
						</div>
						<div class="col-md-4">{{analysis.createdDate | date}}</div>
					</a>
				</li>
			</ul>
		</div>
	</div>
</div>
<th:block layout:fragment="page-scripts" th:inline="javascript">

	<script>
		(function () {
			"use strict";
			var STATE_MAP = /*[[${states}]]*/ {};

			function StateFilter () {
			    return function(state) {
				    return STATE_MAP[state];
			    }
			}

			function AnalysisService ($http) {
				function _loadData () {
					return $http.get(TL.BASE_URL + "analysis/ajax/list");
				}

				return {
					load: _loadData
				}
			}

			function AnalysisController(svc) {
				var vm = this;
				vm.analyses = [];

				svc.load()
					.success(function (data) {
						vm.analyses = data.analyses;
					});
			}

			angular.module('irida.analysis.user', [])
				.filter('StateFilter', [StateFilter])
				.service('AnalysisService',['$http', AnalysisService])
				.controller('AnalysisController', ['AnalysisService', AnalysisController])
			;
		})();
	</script>
</th:block>
</body>
</html>