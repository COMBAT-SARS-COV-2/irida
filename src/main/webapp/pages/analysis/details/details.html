<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="analysis/details/_base">

<head lang="en">
	<meta charset="UTF-8"/>
	<title th:text="#{analysis.details.title(${analysisSubmission.label})}">_Analysis_</title>
	<link rel="stylesheet" href="/resources/css/pages/analyses.css" th:href="@{/resources/css/pages/analyses.css}"/>
</head>

<body>
<main layout:fragment="main">
	<div class="row">
		<div class="col-md-12">
			<h1>
				<span th:text="${analysisSubmission.name}">__TITLE__</span>
				<a id="analysis-download-btn" class="btn btn-primary pull-right" th:if="${#strings.equalsIgnoreCase(analysisSubmission.analysisState, 'COMPLETED')}"
				   th:href="@{/analysis/ajax/download/{id}(id=${analysisSubmission.getId()})}" href="#"
				   data-toggle="tooltip" data-placement="bottom" th:title="#{form.download-files}">
					<span class="fa fa-download fa-fw"></span>
					<span class="sr-only" th:text="#{form.download-files}">Download Files</span>
				</a>
			</h1>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12 ng-cloak">
			<tabset>
				<tab>
					<tab-heading id="tab-preview" th:text="#{analysis.tab.preview}"></tab-heading>
					<div th:if="${preview}" layout:fragment="previewContent"></div>
					<div th:unless="${preview}" layout:fragment="noPreview">__NO_PREVIEW__</div>
				</tab>
				<tab th:unless="${#maps.isEmpty(files)}">
					<tab-heading id="tab-files" th:text="#{analysis.tab.files}"></tab-heading>
					<accordion>
						<accordion-group class="file-info" th:each="file : ${files}">
							<accordion-heading class="filename" th:text="${file.filename}">__FILENAME__</accordion-heading>
							<div th:include="analysis/details/details :: toolsLayout (${file.tools})"></div>
						</accordion-group>
					</accordion>
				</tab>
			</tabset>
		</div>
	</div>
</main>

<div th:fragment="toolsLayout (tools)">
	<div th:each="tool : ${tools}" style="margin-left: 2rem;" th:with="toolId=${'tool' + analysisSubmission.getId() + #dates.createNow().getTime()}" data:ng-init="${toolId + '=false'}">
		<button data:ng-click="${toolId + '=!' + toolId}" class="btn btn-link tool">
			<i data:ng-hide="${toolId}" class="fa fa-fw fa-chevron-right"></i>
			<i data:ng-show="${toolId}" class="fa fa-fw fa-chevron-down"></i>
			<span th:text="${tool.getLabel()}"></span>
		</button>
		<div data:ng-show="${toolId}" class="parameters">
			<table class="table">
				<tr class="parameter" th:each="parameter : ${tool.parameters}">
					<td class="para-key" th:text="${parameter.key}"></td>
					<td class="para-value" th:text="${parameter.value}"></td>
				</tr>
			</table>
		</div>

		<div th:include="analysis/details/details :: toolsLayout (${tool.previousSteps})"></div>
	</div>
</div>

</body>

</html>
