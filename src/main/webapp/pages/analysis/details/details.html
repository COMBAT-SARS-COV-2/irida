<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  data-layout-decorate="~{analysis/details/_base}"
>
  <head></head>

  <body>
    <main layout:fragment="main">
      <div class="row">
        <div class="col-md-12 ng-cloak">

          <script type="text/ng-template" id="provenance.html">
            <div th:if="${isCompleted}" th:with="files=${analysis.getAnalysisOutputFiles()}">
            	<accordion>
            		<accordion-group class="file-info" th:each="file : ${files}">
            			<accordion-heading class="filename">
            				<i class="far fa-file spaced-right__sm"></i>
            				<span class="name" th:text="${file.getLabel()}"></span>
            			</accordion-heading>
            			<div th:include="analysis/details/details :: toolsLayout (${file.getCreatedByTool()})"></div>
            		</accordion-group>
            	</accordion>
            	<div th:fragment="toolsLayout (tools)">
            		<div th:each="tool : ${tools}" style="margin-left: 2rem;"
            			 th:with="toolId=${'tool' + tool.getId()}"
            			 data:ng-init="${toolId + '=false'}">
            			<button data:ng-click="${toolId + '=!' + toolId}" class="btn btn-link tool">
            				<span class="fas fa-chevron-right" data:ng-hide="${toolId}" aria-hidden="true"></span>
            				<span class="fas fa-chevron-down" data:ng-show="${toolId}" aria-hidden="true"></span>
            				&nbsp;<span th:text="${tool.getLabel()}"></span>
            			</button>

            			<!--/*
                                        For every tool used to create the analysis, Thymeleaf will load this template, recursively finding
                                        all tools and their parameters.
                                        Initial tool: AnalysisOutputFile.createByTool
                                    */-->
            			<div data:ng-show="${toolId}" class="parameters">
            				<table class="table">
            					<tr class="parameter" th:each="parameter : ${tool.getExecutionTimeParameters()}">
            						<td class="para-key" th:text="${parameter.key}"></td>
            						<td class="para-value" th:text="${parameter.value}"></td>
            					</tr>
            				</table>
            			</div>
            			<div th:include="analysis/details/details :: toolsLayout (${tool.previousSteps})"></div>
            		</div>
            	</div>
            </div>
            <div th:unless="${isCompleted}"></div>
          </script>
        </div>
      </div>
    </main>
  </body>
</html>
