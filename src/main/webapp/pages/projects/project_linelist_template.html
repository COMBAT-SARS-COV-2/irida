<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="projects/_base">
<head>
    <title th:text="#{linelist.create-template.title}">Title</title>
    <style>
        .form-group {
            margin-bottom: 0!important;
        }
        ul[dnd-list],
        ul[dnd-list] > li {
            position: relative;
        }

        ul[dnd-list] > li {
            border-left: 5px solid #eee;
        }

        ul[dnd-list] .dndDraggingSource {
            display: none;
        }

        ul[dnd-list] .dndPlaceholder {
            display: block;
            background-color: #ddd;
            min-height: 42px;
        }

        ul[dnd-list] {
            padding-left: 0;
        }
    </style>
</head>
<body>
<main layout:fragment="main" ddl:bundle-includes="project-linelist-template">
    <h2 th:text="#{linelist.create-template.title}">Create a New Line List Template</h2>
    <template-input-component
            data:templateurl="@{/projects/{id}/linelist/metadatafields(id=${project.getId()})}"
            data:saveurl="@{/projects/{id}/linelist/linelist-templates/save-template(id=${project.getId()})}"
            data:redirecturl="@{/projects/{id}/linelist(id=${project.getId()})}"/>
    <script type="text/ng-template" id="templateInput.tmpl.html">
        <div class="row">
            <div class="col-md-12">
                <label for="template-name" th:text="#{linelist.create-template.name}">Template Name</label>
            </div>
        </div>
        <div class="row spaced-bottom">
            <div class="form-group col-md-8">
                <div class="form-group">
                    <input id="template-name" class="form-control" type="text" ng-model="$ctrl.template.name"/>
                </div>
            </div>
            <div class="col-md-4">
                <button id="save-template-btn"
                        class="btn btn-primary"
                        ng-disabled="$ctrl.template.name.length &lt; 3"
                        ng-click="$ctrl.saveTemplate()"
                        th:text="#{linelist.create-template.save-template}">Save
                </button>
            </div>
        </div>
        <div class="row spaced-bottom">
            <div class="form-group col-md-8">
                <label for="existing-templates" th:text="#{linelist.create-template.add-existing}">Add Existing
                    Template</label>
                <select id="existing-templates"
                        class="form-control spaced-bottom"
                        multiple="multiple"
                        select2-basic=""
                        ng-change="$ctrl.getUpdatedTemplates()"
                        ng-model="$ctrl.existing">
                    <option th:each="template : ${templates}" th:value="${template.id}"
                            th:text="${template.label}"></option>
                </select>
            </div>
        </div>
        <label th:text="#{linelist.create-template.template-fields}">Template Fields</label>
        <div class="row">
            <div class="col-md-8">
                <ul class="list-group" dnd-list="$ctrl.template.list">
                    <li class="list-group-item" ng-repeat="item in $ctrl.template.list"
                        dnd-draggable="item"
                        dnd-moved="$ctrl.template.list.splice($index, 1)"
                        dnd-effect-allowed="move">
                        <div class="row">
                            <div class="col-md-12">
                                <span class="label label-primary"
                                      style="margin-right: .5em;"
                                      ng-repeat="(template, value) in item.templates">
                                      {{ $ctrl.nameMap.get(template) }}
                                </span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-5">
                                <input ng-disabled="item.templates" type="text" class="form-control field-label"
                                       ng-model="item.label"
                                       placeholder="Field Name"/>
                            </div>
                            <div class="form-group col-md-4">
                                <select disabled="disabled" class="form-control" ng-model="item.type">
                                    <option value="text" th:text="#{linelist.add-field.type.text}">_TEXT_</option>
                                </select>
                            </div>
                            <button class="btn btn-default remove-field-btn"
                                    ng-click="$ctrl.removeField($index)">
                                <fa:icon type="remove"/>
                            </button>
                        </div>
                    </li>
                </ul>
                <button class="btn btn-default add-field-btn"
                        ng-click="$ctrl.addField()"
                        th:text="#{linelist.create-template.new-field}">Add
                </button>
            </div>
        </div>
    </script>
</main>
</body>
</html>