<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="projects/_base">
<head>
    <title th:text="#{linelist.create-template.title}">Title</title>
    <link rel="stylesheet" href="/resources/css/pages/create-linelist-template.css"
          th:href="@{/resources/css/pages/create-linelist-template.css}"/>
    <script th:inline="javascript">
      var PAGE = {
        i18n: {
          success: "Metadata template  successfully created."
        },
        urls: {
          templates: /*[[@{/projects/{id}/linelist/templates/:id(id=${project.getId()})}]]*/ '',
          fields: /*[[@{/projects/{id}/sample-metadata/fields(id=${project.getId()})}]]*/ ''
        }
      };
    </script>
</head>
<body>
<main layout:fragment="main">
    <create-template></create-template>
</main>
<th:block layout:fragment="scripts">
    <script type="text/ng-template" id="create-template.tmpl.html">
        <form name="createTemplateForm">
            <div class="row">
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group"
                                 show-validation="">
                                <label class="control-label"
                                       for="template-name"
                                       th:text="#{linelist.create-template.name}">_TEMPLATE_NAME_</label>
                                <input id="template-name"
                                       name="templateName"
                                       class="form-control"
                                       metadata-template-name=""
                                       existing-templates="$ctrl.templates"
                                       type="text"
                                       required="required"
                                       minlength="5"
                                       ng-model="$ctrl.template.name"/>
                                <div ng-messages="createTemplateForm.templateName.$error"
                                     ng-show="createTemplateForm.templateName.$dirty">
                                    <p class="label label-danger" ng-message="required"
                                       th:text="#{linelist.create-template.templateName.required}">_This is a required
                                        field_</p>
                                    <p class="label label-danger" ng-message="minlength"
                                       th:text="#{linelist.create-template.templateName.minlength}">_Templage name must
                                        be 5
                                        letters long_</p>
                                    <p class="label label-danger" ng-message="unique"
                                       th:text="#{linelist.create-template.saving.error.unique}">
                                        This field already exists.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row spaced-bottom">
                        <div class="col-md-12">
                            <button class="btn btn-default" ng-click="$ctrl.addNewField()">_ADD_NEW_FIELD_</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table" width="100%">
                                <tbody>
                                <tr ng-repeat="field in $ctrl.fields">
                                    <td>{{field.label}}</td>
                                    <td>{{field.type}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <button id="save-template-btn"
                            class="btn btn-primary btn-block"
                            ng-disabled="createTemplateForm.$invalid &amp;&amp; $ctrl.fields.length === 0"
                            ng-click="$ctrl.saveTemplate()"
                            th:text="#{linelist.create-template.save-template}">Save
                    </button>
                </div>
            </div>
        </form>
    </script>
    <script type="text/ng-template" id="addMetadataField.tmpl.html">
        <div class="modal-header">
            <h3 class="modal-title">
                _ADD_METADATA_FIELD_
            </h3>
        </div>
        <div class="modal-body">
            <ui-select ng-model="model.field" style="width: 100%">
                <ui-select-match placeholder="_Search_Metadata_Fields_">{{model.field.label}}</ui-select-match>
                <ui-select-choices
                        repeat="field in model.list"
                        refresh="model.queryName($select.search)"
                        refresh-delay="350"
                        minimum-input-length="2">
                    <div>
                        {{field.label}} <span ng-hide="field.id" class="badge badge-warning">_NEW_</span>
                    </div>
                </ui-select-choices>
            </ui-select>
        </div>
    </script>
    <script src="/resources/js/build/create-metadata-template.bundle.js"
            th:src="@{/resources/js/build/create-metadata-template.bundle.js}"></script>
</th:block>
</body>
</html>