<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="projects/_base">
<head>
    <title th:text="${project.label} + ' - ' + #{project.nav.samples}"></title>
    <script th:inline="javascript">
        window.dependencies = ['irida.projects.samples.controller'];
        var PAGE = {
            urls: {
                associated: {
                    local: /*[[@{/projects/{id}/ajax/associated(id=${project.getId()})}]]*/ ''
                },
                samples: {
                    project: /*[[@{/projects/{id}/ajax/samples(id=${project.getId()})}]]*/ '',
                    local: /*[[@{'/projects/{id}/ajax/samples'}]]*/ '',
                    remove: /*[[@{/projects/{id}/ajax/samples/delete(id=${project.getId()})}]]*/ ''
                },
                remote: /*[[@{/projects/{id}/associated/remote/samples(id=${project.getId()})}]]*/ '',
                merge: /*[[@{/projects/{id}/ajax/samples/merge(id=${project.getId()})}]]*/ '',
                copy: /*[[@{/projects/{id}/ajax/samples/copy(id=${project.getId()})}]]*/ ''
            },
            i18n: {
                associatedSelectedTooltip: /*[[#{project.samples.associated-selected-error}]]*/ '_Unavailable_'
            }
        };
    </script>
</head>
<body>
<main layout:fragment="main" ddl:bundle-includes="project-samples" ddl:asset-css-excludes="jquery.datatables"
      ng-controller="SamplesController as samplesCtrl">

    <table id="samplesTable" datatable="ng" class="table table-hover ng-cloak table-selectable"
           dt-options="samplesCtrl.dtOptions" dt-column-defs="samplesCtrl.dtColumnDefs"
           dt-instance="samplesCtrl.dtInstanceCallback" dt-disable-deep-watchers="true">
        <thead>
        <tr>
            <th class="selection-heading">
                <div class="btn-group btn-group-sm" uib-dropdown="">
                    <button id="selectDropdownToggle" class="btn btn-default" uib-dropdown-toggle=""
                            data:uib-tooltip="#{lists.select-title}" tooltip-append-to-body="true">
                        <input id="selectAllBtn" type="checkbox" ng-model="samplesCtrl.allSelected"
                               ng-click="samplesCtrl.selectAll($event)"/>
                        <span class="caret"></span>
                    </button>
                    <ul uib-dropdown-menu="">
                        <li role="menuitem">
                            <a id="selectPageBtn" href="#" ng-click="samplesCtrl.selectPage($event)"
                               th:text="#{lists.select-page}">Select Page</a></li>
                    </ul>
                </div>
            </th>
            <th th:text="#{project.samples.table.name}">[Name]</th>
            <th th:text="#{project.samples.table.project}" ng-show="samplesCtrl.showProjectname">[Project]</th>
            <th th:text="#{project.samples.table.modified}" width="130px">[Modified Date]</th>
            <th th:text="#{project.samples.table.created}" width="130px">[Created Date]</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="item in samplesCtrl.samples"
            ng-click="item.selected = !item.selected; samplesCtrl.rowClick($event, $index)"
            ng-class="item.selected ? 'selected' : ''" data-index="{{$index}}">
            <td>
                <input type="checkbox" ng-model="item.selected" ng-click="samplesCtrl.rowClick($event, $index)"/>
            </td>
            <td>
                <a data:ng-href="@{'/samples/{{item.sample.identifier}}'}" ng-bind="item.sample.label"></a></td>
            <td ng-bind="item.project.label" ng-show="samplesCtrl.showProjectname"></td>
            <td ng-bind="item.sample.modifiedDate | date"></td>
            <td ng-bind="item.sample.createdDate | date"></td>
        </tr>
        </tbody>
    </table>
</main>
</body>

<th:block layout:fragment="scripts">
    <script type="text/ng-template" id="buttons.html" th:include="projects/partials/samples.tmpl :: toolbar"></script>

    <script th:inline="javascript" type="text/ng-template" id="selectedCounts.html">
        <ng-pluralize id="selected-count-info" count="samplesCtrl.selected.length"
                      data:when="#{project.samples.table.selected}"></ng-pluralize>
    </script>

    <script id="associated-projects.modal.html" type="text/ng-template" th:inline="javascript">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.samples.associated.modal.title}">Projects to include in
                table</h3>
        </div>
        <div class="modal-body">
            <h4 th:text="#{project.samples.associated.modal.local}">Local Associated Projects</h4>
            <table class="associated-projects-table" width="100%">
                <tr ng-class="associatedProjectsCtrl.display.project ? 'selected' : ''"
                    ng-click="associatedProjectsCtrl.display.project = !associatedProjectsCtrl.display.project">
                    <td width="300px">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" ng-model="associatedProjectsCtrl.display.project"/>&nbsp;
                                <th:block th:text="${project.label}"></th:block>
                            </label>
                        </div>
                    </td>
                    <td th:text="${project.organism}"></td>
                    <td><span class="label label-info" th:text="#{project.samples.associated.modal.current-project}">Current Project</span>
                    </td>
                </tr>
                <tr ng-class="project.selected ? 'selected' : ''"
                    ng-repeat="project in associatedProjectsCtrl.projects.local"
                    ng-click="project.selected = !project.selected">
                    <td>
                        <div class="checkbox"><label>
                            <input type="checkbox" ng-model="project.selected"/>&nbsp;{{project.label}}
                        </label></div>
                    </td>
                    <td ng-bind="project.organism"></td>
                    <td></td>
                </tr>
            </table>
            <strong ng-hide="associatedProjectsCtrl.projects.local">
                <fa:icon type="loading" fixed="true"/>
                &nbsp;
                <th:block th:text="#{project.samples.associated.modal.fetching-local}"></th:block>
            </strong>
            <div class="alert alert-info" ng-show="associatedProjectsCtrl.projects.local.length === 0">
                <strong th:text="#{project.samples.associated.modal.no-local}">No Locally Associated Projects</strong>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="associatedProjectsCtrl.close()" th:text="#{form.btn.cancel}">
                [Cancel]
            </button>
            <button class="btn btn-primary" ng-click="associatedProjectsCtrl.showProjects()"
                    th:text="#{project.samples.associated.modal.selectBtn}">[Show Selected Projects]
            </button>
        </div>
    </script>

    <script type="text/ng-template" id="samplesUpdate.html" th:inline="javascript">
        <div>
            <strong th:text="#{project.samples.display.notification.title}">Displaying:</strong><br/>
            <ul>
                <li ng-repeat='item in items' th:text="#{project.samples.display.notification.item}"></li>
            </ul>
        </div>
    </script>

    <script type="text/ng-template" id="removeSamples.modal.html" th:inline="javascript">
        <div class="modal-header">
            <h3 class="modal-title">
                <ng-pluralize count="removeCtrl.samples.length"
                              data:when="#{project.samples.modal.remove.title}"></ng-pluralize>
            </h3>
        </div>
        <div class="modal-body">
            <strong>
                <ng-pluralize count="removeCtrl.samples.length" data:when="#{project.samples.modal.remove.description}"></ng-pluralize>
            </strong>
            <ul>
                <li ng-repeat="item in removeCtrl.samples" ng-bind="item.sample.label"></li>
            </ul>
            <div class="alert alert-warning">
                <strong><fa:icon type="warning" fixed="true"/></strong>&nbsp;
                <ng-pluralize count="removeCtrl.samples.length" data:when="#{project.samples.modal.remove.warning}"></ng-pluralize>
            </div>
        </div>
        <div class="modal-footer">
            <button id="removeBtnCancel" class="btn btn-default" th:text="#{form.btn.cancel}" ng-click="removeCtrl.cancel()"></button>
            <button id="removeBtnOk" class="btn btn-warning" th:text="#{form.btn.remove}" ng-click="removeCtrl.remove()"></button>
        </div>
    </script>

    <script type="text/ng-template" id="mergeSamples.modal.html" th:inline="javascript">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.samples.combine-title}">[Merging Samples]</h3>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col-md-12">
                    <h4 th:text="#{project.samples.combine-samples-heading}">
                        [All data will be merged into the selected sample.]
                    </h4>
                    <p th:text="#{project.samples.combine-samples-note}"></p>
                </div>
                <div class="col-md-12">
                    <div ng-repeat="item in mergeCtrl.samples" class="radio"><label>
                        <input type="radio" name="mergeSample" ng-model="mergeCtrl.mergeSampleId"
                               ng-value="item.sample.identifier"/>
                        {{item.sample.label}} </label>
                    </div>
                    <hr/>
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" name="mergeSample" ng-model="mergeCtrl.useNewName" />
                            <strong th:text="#{project.samples.combine-new-name}"></strong>
                        </label>
                    </div>
                    <div class="form-group" ng-show="mergeCtrl.useNewName">
                        <input type="text" ng-disabled="!mergeCtrl.useNewName" class="form-control" ng-model="mergeCtrl.newName" />
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="mergeBtnCancel" class="btn btn-default" th:text="#{form.btn.cancel}" ng-click="mergeCtrl.cancel()"></button>
            <button id="mergeBtnMerge" class="btn btn-primary" th:text="#{project.samples.combine-button}" ng-click="mergeCtrl.doMerge()"></button>
        </div>
    </script>
</th:block>
</html>