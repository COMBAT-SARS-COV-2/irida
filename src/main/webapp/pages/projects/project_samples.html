<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="projects/_base">
<head>
    <title th:text="${project.label} + ' - ' + #{project.nav.samples}"></title>
    <script th:inline="javascript">
        window.dependencies = ['irida.projects.samples.controller'];
        var PAGE = {
            urls: {
                associated: {
                    local: /*[[@{/projects/{id}/ajax/associated(id=${project.getId()})}]]*/ ''
                },
                modals: {
                    remove: /*[[@{/projects/templates/remove-modal}]]*/ '/projects/templates/remove-modal',
                    merge: /*[[@{/projects/templates/merge-modal}]]*/ '/projects/templates/merge-modal',
                    copy: /*[[@{/projects/templates/copy-modal(projectId=${project.getId()})}]]*/ '/projects/templates/copy-modal',
                    move: /*[[@{/projects/templates/move-modal(projectId=${project.getId()})}]]*/ '/projects/templates/move-modal'
                },
                projects: {
                  available: /*[[@{/projects/{id}/ajax/samples/available_projects(id=${project.getId()})}]]*/ ''
                },
                samples: {
                    project: /*[[@{/projects/{id}/ajax/samples(id=${project.getId()})}]]*/ '',
                    local: /*[[@{'/projects/{id}/ajax/samples'}]]*/ '',
                    remove: /*[[@{/projects/{id}/ajax/samples/delete(id=${project.getId()})}]]*/ '',
                    merge: /*[[@{/projects/{id}/ajax/samples/merge(id=${project.getId()})}]]*/ '',
                    copy: /*[[@{/projects/{id}/ajax/samples/copy(id=${project.getId()})}]]*/ ''
                },
                remote: /*[[@{/projects/{id}/associated/remote/samples(id=${project.getId()})}]]*/ ''
            },
            i18n: {
                dateFilter: {
                    days30: /*[[#{project.sample.filter.date.days30}]]*/ "Last 30 Days",
                    days60: /*[[#{project.sample.filter.date.days60}]]*/ "Last 60 Days",
                    days120: /*[[#{project.sample.filter.date.days120}]]*/ "Last 120 Days"
                }
            }
        };
    </script>
    <style>
        .dataTables_filter, .filter-area {
            display: inline-block !important;
            float: right;
        }
    </style>
</head>
<body>
<main layout:fragment="main" ddl:bundle-includes="project-samples" ddl:asset-css-excludes="jquery.datatables">

    <div role="toolbar" aria-label="Sample Table Tools">
        <div uib-dropdown="" auto-close="outsideClick" ng-controller="AssociatedProjectsController as apCtrl">
            <button id="associated-btn" class="btn btn-default" uib-dropdown-toggle="" aria-haspopup="true">Associated
                Projects&nbsp;
                <fa:icon type="caret-down" fixed="fixed"/>
            </button>
            <ul id="associated-dropdown" class="dropdown-menu" uib-dropdown-menu="" role="menu" aria-labelledby="associated-btn">
                <li role="menuitemcheckbox" th:each="associated : ${associatedProjects}">
                    <a href="#">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" data:id="${associated.getId()}" ng-click="apCtrl.toggleAssociatedProject($event)"/>
                                &nbsp;
                                <th:block th:text="${associated.label}"></th:block>
                            </label>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div dt:conf="samplesTable">
        <div dt:confType="extrajs" dt:bundles="project-samples-table" dt:placeholder="before_end_document_ready"/>
        <div dt:confType="extrajs" dt:bundles="project-samples-angular" dt:placeholder="before_start_document_ready"/>
    </div>
    <table id="samplesTable" dt:table="true" dt:url="@{/projects/{id}/ajax/samples(id=${project.getId()})}">
        <thead>
        <tr>
            <th dt:property="sample.sampleName" th:text="#{project.samples.table.name}"></th>
            <th dt:property="project.name" th:text="#{project.samples.table.project}"></th>
            <th width="120px" dt:property="sample.createdDate" dt:sortType="natural" th:text="#{project.samples.table.created}"
                dt:renderFunction="datatables-utils#datatable.formatDate"></th>
            <th width="120px" dt:property="sample.modifiedDate" dt:sortType="natural" dt:sortInitDirection="desc" th:text="#{project.samples.table.modified}"
                dt:renderFunction="datatables-utils#datatable.formatDate"></th>
        </tr>
        </thead>
    </table>
</main>
</body>

<th:block layout:fragment="scripts">
    <script type="text/ng-template" id="buttons.html" th:include="projects/partials/samples.tmpl :: toolbar"></script>
    <script type="text/ng-template" id="filterButtons.html">
        <div th:replace="projects/partials/samples.tmpl :: filterButtons"></div>
    </script>

    <script type="text/ng-template" id="activeFilters.html">
        <div class="text-right">
            <span ng-repeat="(filter, value) in samplesCtrl.filter">
                <span class="label label-default" ng-if="filter==='name'" ng-click="samplesCtrl.clearFilterProperty('name')"><th:block th:text="#{project.sample.filter-name}"></th:block> : {{ value }}</span>
                <span class="label label-default" ng-if="filter==='date' &amp;&amp; value['startDate']!==null" ng-click="samplesCtrl.clearFilterProperty('startDate')"><th:block th:text="#{project.sample.filter-date.startDate}"></th:block> : {{ value.startDate | date }}</span>
                <span class="label label-default" ng-if="filter==='date' &amp;&amp; value['endDate']!==null" ng-click="samplesCtrl.clearFilterProperty('endDate')"><th:block th:text="#{project.sample.filter-date.endDate}"></th:block> : {{ value.endDate | date }}</span>
            </span>
        </div>
    </script>

    <script th:inline="javascript" type="text/ng-template" id="selectedCounts.html">
        <ng-pluralize id="selected-count-info" count="samplesCtrl.selected.length"
                      data:when="#{project.samples.table.selected}"></ng-pluralize>
    </script>

    <script id="filter.modal.html" type="text/ng-template">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.sample.filter-title}">[Filter Samples]</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="name" th:text="#{project.sample.filter-name}">Name</label>
                <input type="text" class="form-control" id="name" ng-model="filterCtrl.filter.name"/>
            </div>
            <div class="form-group">
                <label for="daterange" th:text="#{project.sample.filter-date}">Date</label>
                <input id="daterange" type="text" date-range-picker="" class="form-control date-picker" options="filterCtrl.options" ng-model="filterCtrl.filter.date"/>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="filterCtrl.cancel()" th:text="#{form.btn.cancel}">Cancel</button>
            <button id="doFilterBtn" class="btn btn-primary" ng-click="filterCtrl.doFilter()" th:text="#{table.filter.openBtn}">Filter</button>
        </div>
    </script>

    <script id="associated-projects.modal.html" type="text/ng-template" th:inline="javascript">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.samples.associated.modal.title}">Projects to include in
                table</h3>
        </div>
        <div class="modal-body">
            <h4 th:text="#{project.samples.associated.modal.local}">Local Associated Projects</h4>
            <table class="associated-projects-table" width="100%">
                <tr ng-class="associatedProjectsCtrl.display.project ? 'selected' : ''"
                    ng-click="associatedProjectsCtrl.display.project = !associatedProjectsCtrl.display.project">
                    <td width="300px">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" ng-model="associatedProjectsCtrl.display.project"/>&nbsp;
                                <th:block th:text="${project.label}"></th:block>
                            </label>
                        </div>
                    </td>
                    <td th:text="${project.organism}"></td>
                    <td><span class="label label-info" th:text="#{project.samples.associated.modal.current-project}">Current Project</span>
                    </td>
                </tr>
                <tr ng-class="project.selected ? 'selected' : ''"
                    ng-repeat="project in associatedProjectsCtrl.projects.local"
                    ng-click="project.selected = !project.selected; associatedProjectsCtrl.rowClick($event)">
                    <td>
                        <div class="checkbox"><label>
                            <input type="checkbox" ng-model="project.selected"/>&nbsp;{{project.getName()}}
                        </label></div>
                    </td>
                    <td ng-bind="project.getOrganism()"></td>
                    <td></td>
                </tr>
            </table>
            <strong ng-hide="associatedProjectsCtrl.projects.local">
                <fa:icon type="loading" fixed="true"/>
                &nbsp;
                <th:block th:text="#{project.samples.associated.modal.fetching-local}"></th:block>
            </strong>
            <div class="alert alert-info" ng-show="associatedProjectsCtrl.projects.local.length === 0">
                <strong th:text="#{project.samples.associated.modal.no-local}">No Locally Associated Projects</strong>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="associatedProjectsCtrl.close()" th:text="#{form.btn.cancel}">
                [Cancel]
            </button>
            <button class="btn btn-primary" ng-click="associatedProjectsCtrl.showProjects()"
                    th:text="#{project.samples.associated.modal.selectBtn}">[Show Selected Projects]
            </button>
        </div>
    </script>

    <script type="text/ng-template" id="samplesUpdate.html" th:inline="javascript">
        <div>
            <strong th:text="#{project.samples.display.notification.title}">Displaying:</strong><br/>
            <ul>
                <li ng-repeat='item in items' th:text="#{project.samples.display.notification.item}"></li>
            </ul>
        </div>
    </script>
</th:block>
</html>
