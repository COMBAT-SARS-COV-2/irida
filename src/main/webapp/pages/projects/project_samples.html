<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="projects/_base">
<head>
	<title th:text="${project.label} + ' - ' + #{project.nav.samples}"></title>
	<link rel="stylesheet" th:href="@{/resources/bower_components/angular-busy/angular-busy.css}"
	      href="/resources/bower_components/angular-busy/angular-busy.css"/>
	<link rel="stylesheet" th:href="@{/resources/bower_components/select2/select2.css}"
	      href="/resources/bower_components/select2/select2.css"/>
	<link rel="stylesheet" th:href="@{/resources/bower_components/select2/select2-bootstrap.css}"
	      href="/resources/bower_components/select2/select2-bootstrap.css"/>
    <link rel="stylesheet" href="/resources/css/pages/project_samples.css" th:href="@{/resources/css/pages/project_samples.css}"/>
	<script>window.dependencies = ['Samples'];</script>
	<style>
		td {
			vertical-align: middle!important;
		}
	</style>
</head>
<body>
<aside class="sidebar ng-cloak" layout:fragment="filter" ng-controller="FilterCtrl as sf">
	<div class="sidebar__heading clearfix">
		<h2 class="pull-left" th:text="#{project.sample.filter-title}">Samples Filter</h2>
		<span ng-show="sampleCount === 0 || sf.count !== sampleCount" class="badge badge-primary pull-right ng-cloak"><span
			id="samples-filtered" ng-bind="sf.count">0</span> <span th:text="#{grammar.of}"></span> <span
			id="samples-total" ng-bind="sampleCount">0</span></span>
	</div>
	<div class="sidebar__body">

		<div class="form-group" ng-controller="FilterCountCtrl as filterCountCtrl">
			<label for="count" th:text="#{table.filter.count}">Page Size</label>
			<select id="count" class="form-control" style="width: 100%;" ng-model="filterCountCtrl.count"
			        ng-change="filterCountCtrl.updateCount()">
				<option value="10">10</option>
				<option value="25">25</option>
				<option value="50">50</option>
				<option value="All">All</option>
			</select>
		</div>
		<div class="form-group">
			<label for="sample-name-filter" th:text="#{project.sample.filter-name}">_Sample Name</label>

			<div class="input-group">
				<input type="text" class="form-control" id="sample-name-filter" ng-model="sf.sampleName"/>
				<span class="input-group-btn">
					<button class="btn btn-default" ng-click="sf.sampleName=''">
						<span class="fa fa-fw fa-remove"></span>
					</button>
				</span>
			</div>
		</div>
		<div class="form-group">
			<label for="sample-organism-filter" th:text="#{project.sample.filter-organism}">_Sample Organism</label>

			<div class="input-group">
				<input type="text" class="form-control" id="sample-organism-filter" ng-model="sf.organism"/>
				<span class="input-group-btn">
					<button class="btn btn-default" ng-click="sf.organism=''">
						<span class="fa fa-fw fa-remove"></span>
					</button>
				</span>
			</div>
		</div>
	</div>
</aside>
<main layout:fragment="main" data:ng-init="${'projectId=' + project.getId()}">
	<div class="row">
		<div class="col-md-12">
			<h1 role="heading" th:text="#{project.samples.h1(${project.label})}">__PAGE_TITLE__</h1>
		</div>
	</div>
	<div class="row mrgn-bttm-md">
		<div class="col-md-12" ng-controller="SubNavCtrl as subnav">
			<div class="btn-toolbar pull-left">
				<!-- Sample Selection (Page, All, None) -->
				<div class="btn-group" dropdown="" is-open="subnav.selection.isopen">
					<button id="selectBtn" type="button" class="btn btn-default btn-sm dropdown-toggle"
					        dropdown-toggle="">
                        <span ng-controller="SelectedCountCtrl as countCtrl" id="selected-count"
                              class="label label-default" ng-bind="countCtrl.count">0</span>
						<span th:text="#{lists.select-title}">Select</span>
						&nbsp;
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu" role="menu">
						<li>
							<a id="selectPageBtn" href="#" th:text="#{lists.select-page}"
							   ng-click="subnav.selection.selectPage()">Select Page
							</a>
						</li>
						<li>
							<a id="selectAllBtn" href="#" th:text="#{lists.select-all}"
							   ng-click="subnav.selection.selectAll()">Select All
							</a>
						</li>
						<li class="divider"></li>
						<li>
							<a id="selectNoneBtn" href="#" th:text="#{lists.select-none}"
							   ng-click="subnav.selection.selectNone()">Select None
							</a>
						</li>
					</ul>
				</div>

				<div ng-controller="SampleDisplayCtrl as displayCtrl" class="btn-group drop-check" dropdown=""
				     is-open="subnav.display.isopen">
					<button id="displayBtn" type="button" class="btn btn-default btn-sm dropdown-toggle ng-cloak"
					        ng-hide="uiGalaxyCtrl.inGalaxy"
					        dropdown-toggle="">
						<span th:text="#{project.samples.display.title}">_Display_</span>
						&nbsp;
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu noclose ng-cloak" role="menu" ng-hide="uiGalaxyCtrl.inGalaxy">
						<li class="sample-type-selector local-sample">
							<label> <input id="displayLocal" type="checkbox" ng-change="displayCtrl.displaySamples()"
							               ng-model="displayCtrl.displayLocal"/>
								<span th:text="#{project.samples.display.local(${project.label})}">_Local Samples_</span>
							</label>

						</li>
						<li class="sample-type-selector associated-sample">
							<label> <input id="displayAssociated" type="checkbox"
							               ng-change="displayCtrl.displaySamples()"
							               ng-model="displayCtrl.displayAssociated"/>
								<span th:text="#{project.samples.display.associated}">_Associated Samples_</span>
							</label>
						</li>
                        <li class="sample-type-selector remote-sample">
                            <label> <input id="displayRemote" type="checkbox"
                                           ng-change="displayCtrl.displaySamples()"
                                           ng-model="displayCtrl.displayRemote"/>
                                <span th:text="#{project.samples.display.remote}">_Remote Samples_</span>
                            </label>
                        </li>
					</ul>
				</div>

				<!-- Samples Options (Download, Copy, Merge, Move)-->
				<div class="btn-group" dropdown="" is-open="subnav.samplesOptions.open">
					<button id="samplesOptionsBtn" class="btn btn-default btn-sm dropdown-toggle ng-cloak" dropdown-toggle=""
					        ng-hide="uiGalaxyCtrl.inGalaxy">
						<span>Samples</span>
						&nbsp;
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu ng-cloak" role="menu" ng-hide="uiGalaxyCtrl.inGalaxy">
						<li id="merge-li" ng-class="{disabled:subnav.count&lt;2 || ! subnav.localSelected}"
						    ng-attr-tooltip="{{subnav.showTooltip()}}" tooltip-append-to-body="true"
						    tooltip-placement="right">
							<a id="mergeBtn" href="#" ng-click="subnav.merge()">
								<span class="fa fa-fw fa-compress"></span>
								&nbsp;
								<span th:text="#{project.samples.nav.merge}">Merge</span>
							</a>
						</li>
						<th:block th:if="${isOwner} or ${isAdmin}">
							<li id="copy-li" ng-class="{disabled: subnav.count&lt;1}">
								<a id="copyBtn" href="" ng-click="subnav.openModal('copy')">
									<span class="fa fa-fw fa-copy"></span>
									&nbsp;
									<span th:text="#{project.samples.nav.copy}">_COPY_</span>
								</a>
							</li>
							<li id="move-li" class="local-only" ng-class="{disabled: subnav.count&lt;1 || ! subnav.localSelected}"
							    ng-attr-tooltip="{{subnav.showTooltip()}}" tooltip-append-to-body="true"
							    tooltip-placement="right">
								<a id="moveBtn" href="#" ng-click="subnav.openModal('move')">
									<span class="fa fa-truck fa-fw"></span>
									&nbsp;
									<span th:text="#{project.samples.nav.move}"></span>
								</a>
							</li>
							<li id="remove-li" class="local-only" ng-class="{disabled: subnav.count&lt;1 || ! subnav.localSelected}"
							    ng-attr-tooltip="{{subnav.showTooltip()}}" tooltip-append-to-body="true"
							    tooltip-placement="right">
								<a id="removeBtn" href="#" ng-click="subnav.remove()">
									<i class="fa fa-trash fa-fw"></i> &nbsp;
									<span th:text="#{project.samples.nav.remove}"></span>
								</a>
							</li>
							<li class="divider"></li>
							<li>
								<a th:href="@{/projects/{projectId}/samples/new(projectId=${project.getId()})}"
								   href="#">
									<span class="fa fa-fw fa-plus"></span>
									&nbsp;
									<th:block th:text="#{project.samples.nav.new}">__New Sample__</th:block>
								</a>
							</li>
						</th:block>
					</ul>
				</div>

				<div class="btn-group" dropdown="" is-open="subnav.export.open">
					<button id="exportOptionsBtn" class="btn btn-default btn-sm dropdown-toggle" dropdown-toggle=""
					        ng-disabled="subnav.count&lt;1">
						<span th:text="#{project.samples.export.label}">Export</span>
						&nbsp;
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu" role="menu">
						<li>
							<a id="exportDownloadBtn" href="#" ng-click="subnav.export.download()">
								<span class="fa fa-fw fa-download"></span>
								&nbsp;
								<span th:text="#{form.download}">_Download</span>
							</a>
						</li>
						<li th:if="${linkerAvailable}" ng-class="{disabled: ! subnav.localSelected}"
						    ng-attr-tooltip="{{subnav.showTooltip()}}" tooltip-append-to-body="true"
						    tooltip-placement="right">
							<a id="exportLinkerBtn" href="#" ng-click="subnav.export.linker()">
								<span class="fa fa-fw fa-terminal"></span>
								&nbsp;
								<span th:text="#{project.samples.export.linker}"></span>
							</a>
						</li>
						<li th:if="${galaxyCallback}">
							<a href="#" ng-click="subnav.export.galaxy(); cart.show=false">
								<span class="fa fa-fw fa-cloud"></span>
								&nbsp;
								<span th:text="#{project.samples.export.galaxy}"></span>
							</a>
						</li>
					</ul>
				</div>

                <div class="btn-group">
    				<button id="cart-add-btn" ng-controller="CartController as cart" ng-click="cart.add()" type="button"
    				        class="btn btn-info btn-sm" ng-disabled="subnav.count&lt;1">
    					<i class="fa fa-fw fa-cart-plus"></i>
    					<span th:text="#{project.samples.nav.add-to-cart}">Add to Cart></span>
    				</button>
                </div>
			</div>
      
            <div class="btn-group pull-right" dropdown="" ng-controller="ConnectionWarningCtrl as warnings" ng-show="warnings.notConnected.length > 0">
                <button class="btn btn-warning btn-sm dropdown-toggle" dropdown-toggle="">
                    <span class="label label-default" ng-bind="warnings.notConnected.length">0</span>
                    <span>Warnings</span>
                    &nbsp;
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="api in warnings.notConnected">
                        <a th:href="@{/remote_api/{{api.identifier}}}" th:text="#{project.samples.warning.notConnected}"></a>
                    </li>
                </ul>
            </div>
		</div>
	</div>
	<div class="row"
	     data:cg-busy="'{promise: cgPromise,templateUrl:\'' + @{/resources/bower_components/angular-busy/angular-busy.html} + '\', delay: 250, backdrop:true, message: \'' + #{cg-busy.samples.table} +  '\'}'">
		<div class="col-md-12" ng-controller="SamplesTableCtrl as table">
			<table id="samplesTable" class="table ng-cloak">
				<thead>
				<tr ng-controller="SortCtrl as sCtrl">
					<th></th>
					<th id="sortName" th:text="#{project.samples.table.name}" sort-by="" onsort="sCtrl.onSort"
					    sortdir="sCtrl.filter.sortDir"
					    sortedBy="sCtrl.filter.sortedBy" sortValue="sample.sampleName">__NAME__
					</th>
					<th id="sortOrganism" th:text="#{project.samples.table.organism}" sort-by="" onsort="sCtrl.onSort"
					    sortdir="sCtrl.filter.sortDir"
					    sortedBy="sCtrl.filter.sortedBy" sortValue="sample.organism">__ORGANISM__
					</th>
					<th id="sortCollectedBy" th:text="#{project.samples.table.collectedBy}" sort-by=""
					    onsort="sCtrl.onSort" sortdir="sCtrl.filter.sortDir"
					    sortedBy="sCtrl.filter.sortedBy" sortValue="sample.collectedBy">Collected By
					</th>
					<th id="sortProject" sort-by="" onsort="sCtrl.onSort" sortdir="sCtrl.filter.sortDir"
					    sortedBy="sCtrl.filter.sortedBy" sortValue="project.label" ng-show="table.requested.associated || table.requested.remote">Project
					</th>
					<th id="sortCreatedDate" th:text="#{project.samples.table.created}" sort-by="" onsort="sCtrl.onSort"
					    sortdir="sCtrl.filter.sortDir"
					    sortedBy="sCtrl.filter.sortedBy" sortValue="sample.createdDate">__CREATED__
					</th>
				</tr>
				</thead>
				<tbody th:inline="text">
				<tr class="sample-row" ng-class="{'selected': entry.selected, 'local-sample' : entry.sampleType=='LOCAL', 'associated-sample' : entry.sampleType=='ASSOCIATED', 'remote-sample' : entry.sampleType=='REMOTE'}"
				    ng-repeat="(sample, entry) in table.samples | SamplesFilter | orderBy: table.filter.sortedBy : table.filter.sortDir | PagingFilter">
					<td>
						<md-checkbox th:attr="aria-label=#{project.smaples.aria.select}" class="md-primary" id="s-{{entry.identifier}}" name="s-{{entry.identifier}}" ng-model="entry.selected" ng-change="table.updateSample(entry)"></md-checkbox>
					</td>
					<td class="sample-name">
							<md-button class="md-primary" ng-if="entry.sampleType!='REMOTE'"
							   data:ng-href="@{'/projects/' + ${project.getId()} + '/samples/{{entry.sample.identifier}}/sequenceFiles'}"
							   href="#">
								<span class="crop">{{entry.sample.sampleName}}</span>
							</md-button>
							<span ng-if="entry.sampleType=='REMOTE'">{{entry.sample.sampleName}}</span>
					</td>
					<td>{{entry.sample.organism}}</td>
					<td>{{entry.sample.collectedBy}}</td>
					<td ng-show="table.requested.associated || table.requested.remote">
					   <span ng-if="entry.sampleType != 'LOCAL'">
                            {{entry.project.label}}
						</span>
					</td>
					<td class="createdDate" data-date="{{entry.sample.createdDate}}">
						<span layout-padding="">
							<span>{{entry.sample.createdDate | date:'[[#{datepicker.short}]]'}}</span>
							<md-tooltip md-direction="top">
								{{entry.sample.createdDate | date:'medium'}}
							</md-tooltip>
						</span>
					</td>
				</tr>
				</tbody>
				<tfoot>
				<tr>
					<td colspan="5" class="text-center">
						<div pagination="" ng-controller="PagingCtrl as paging" ng-model="paging.page"
						     items-per-page="paging.count"
						     total-items="paging.total" ng-change="paging.update()"></div>
					</td>
				</tr>
				</tfoot>
			</table>
		</div>
	</div>
</main>

<th:block layout:fragment="scripts" th:inline="javascript">
	<script th:inline="javascript">
		var PAGE = {
			urls: {
				local: /*[[@{/projects/{id}/ajax/samples(id=${project.identifier})}]]*/ '',
				associated: /*[[@{/projects/{id}/associated/samples(id=${project.identifier})}]]*/ '',
				remote: /*[[@{/projects/{id}/associated/remote/samples(id=${project.identifier})}]]*/ '',
				merge: /*[[@{/projects/{id}/ajax/samples/merge(id=${project.identifier})}]]*/ '',
				remove: /*[[@{/projects/{id}/ajax/samples/delete(id=${project.identifier})}]]*/ '',
				copy: /*[[@{/projects/{id}/ajax/samples/copy(id=${project.identifier})}]]*/ ''
			},
			i18n: {
				associatedSelectedTooltip: /*[[#{project.samples.associated-selected-error}]]*/ '_Unavailable_'
			}
		};
	</script>
	<script th:src="@{/resources/bower_components/select2/select2.min.js}"
	        src="/resources/bower_components/select2/select2.min.js"></script>
	<script th:src="@{/resources/bower_components/angular-busy/angular-busy.js}"
	        src="/resources/bower_components/angular-busy/angular-busy.js"></script>
	<script th:src="@{/resources/js/directives/datatables/irida-datatable.js}"
	        src="/resources/js/directives/datatables/irida-datatable.js"></script>
	<script th:src="@{/resources/js/pages/projects/samples.js}" src="/resources/js/pages/projects/samples.js"></script>
</th:block>
</body>
</html>
