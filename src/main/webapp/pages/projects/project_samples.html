<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorator="projects/_base">
<head>
    <title th:text="${project.label} + ' - ' + #{project.nav.samples}"></title>
    <script th:inline="javascript">
        window.dependencies = ['irida.projects.samples.controller'];
        var PAGE = {
            project: {
                id: /*[[${project.getId()}]]*/ '4'
            },
            ajaxParam: {},
            urls: {
                associated: {
                    local: /*[[@{/projects/{id}/ajax/associated(id=${project.getId()})}]]*/ ''
                },
                modals: {
                    remove: /*[[@{/projects/templates/remove-modal}]]*/ '/projects/templates/remove-modal',
                    merge: /*[[@{/projects/templates/merge-modal}]]*/ '/projects/templates/merge-modal',
                    copy: /*[[@{/projects/templates/copy-modal(projectId=${project.getId()})}]]*/ '/projects/templates/copy-modal',
                    move: /*[[@{/projects/templates/move-modal(projectId=${project.getId()})}]]*/ '/projects/templates/move-modal'
                },
                projects: {
                  available: /*[[@{/projects/{id}/ajax/samples/available_projects(id=${project.getId()})}]]*/ ''
                },
                samples: {
                    project: /*[[@{/projects/{id}/ajax/samples(id=${project.getId()})}]]*/ '',
                    local: /*[[@{'/projects/{id}/ajax/samples'}]]*/ '',
                    remove: /*[[@{/projects/{id}/ajax/samples/delete(id=${project.getId()})}]]*/ '',
                    merge: /*[[@{/projects/{id}/ajax/samples/merge(id=${project.getId()})}]]*/ '',
                    copy: /*[[@{/projects/{id}/ajax/samples/copy(id=${project.getId()})}]]*/ '',
                    download: /*[[@{/projects/{id}/download/files(id=${project.getId()})}]]*/ '/projects/1/download/files',
                    ncbi: /*[[@{/projects/{id}/export/ncbi(id=${project.getId()})}]]*/ '/projects/1/export/ncbi',
                    linker: /*[[@{/projects/template/samples/linker}]]*/ '/projects/1/samples/linker'
                },
                fileMissingSamples: /*[[@{/projects/{id}/ajax/samples/missing(id=${project.getId()})}]]*/ "/projects/{projectId}/ajax/samples/missing"
            },
            i18n: {
                dateFilter: {
                    days30: /*[[#{project.sample.filter.date.days30}]]*/ "Last 30 Days",
                    days60: /*[[#{project.sample.filter.date.days60}]]*/ "Last 60 Days",
                    days120: /*[[#{project.sample.filter.date.days120}]]*/ "Last 120 Days"
                },
                selectedCounts: {
                    none: /*[[#{project.samples.counts.none}]]*/ "No samples selected",
                    one: /*[[#{project.samples.counts.one}]]*/ "1 sample selected",
                    other: /*[[#{project.samples.counts.more}]]*/ "{count} samples selected"
                },
                fileFilter: {
                    success: /*[[#{project.sample.filterByFile.success}]]*/ "All sample names found"
                }
            }
        };
    </script>
    <style>
        .dataTables_filter, .filter-area {
            display: inline-block !important;
            float: right;
        }
        .project-label{
            border-left: 4px solid #ECEFF1;
            padding-left: 4px;
        }
    </style>
</head>
<body>
<main id="project-samples-main" layout:fragment="main" ddl:bundle-includes="project-samples" ddl:asset-css-excludes="jquery.datatables">
    <div dt:conf="samplesTable">
        <div dt:confType="extrajs" dt:bundles="project-samples-table" dt:placeholder="before_end_document_ready"/>
        <div dt:confType="extrajs" dt:bundles="project-samples-angular" dt:placeholder="before_start_document_ready"/>
        <div dt:confType="callback" dt:type="createdrow" dt:function="datatables-utils#datatable.projectRowCreated"></div>
    </div>
    <table class="selectable" id="samplesTable" dt:table="true" dt:url="@{/projects/{id}/ajax/samples(id=${project.getId()})}" dt:ajaxParams="sample-ajax-params#samplesAjaxParams">
        <thead>
        <tr>
            <th dt:sortable="false" width="20px" dt:renderFunction="datatables-utils#datatable.formatCheckbox"></th>
            <th dt:property="sample.sampleName" th:text="#{project.samples.table.name}" dt:renderFunction="datatables-utils#datatable.formatSampleLink"></th>
            <th dt:property="project.name" th:text="#{project.samples.table.project}" dt:renderFunction="datatables-utils#datatable.highlightAssociatedProjectRows"></th>
            <th width="120px" dt:property="sample.createdDate" dt:sortType="natural" th:text="#{project.samples.table.created}"
                dt:renderFunction="datatables-utils#datatable.formatDate"></th>
            <th width="120px" dt:property="sample.modifiedDate" dt:sortType="natural" dt:sortInitDirection="desc" th:text="#{project.samples.table.modified}"
                dt:renderFunction="datatables-utils#datatable.formatDate"></th>
        </tr>
        </thead>
    </table>
    <div class="hidden">
        <filtered-tags id="filtered-tags"></filtered-tags>
        <samples-filter id="filter-btns"></samples-filter>
        <div id="toolbar">
            <div role="toolbar" aria-label="Sample Table Tools">
                <div style="display: inline-block;" th:if="${not #lists.isEmpty(associatedProjects)}" uib-dropdown=""
                     auto-close="outsideClick"
                     ng-controller="AssociatedProjectsController as apCtrl">
                    <button id="associated-btn" class="btn btn-default btn-sm" uib-dropdown-toggle=""
                            aria-haspopup="true">
                        <th:block th:text="#{project.samples.nav.associated}"></th:block>
                        &nbsp;
                        <fa:icon type="caret-down" fixed="fixed"/>
                    </button>
                    <ul id="associated-dropdown" class="dropdown-menu" uib-dropdown-menu="" role="menu"
                        aria-labelledby="associated-btn">
                        <li role="menuitemcheckbox" th:each="associated : ${associatedProjects}">
                            <a href="#" style="display: block;" data:id="${associated.getId()}"
                               ng-click="apCtrl.toggleAssociatedProject($event)">
                                <div class="checkbox" style="display: block;">
                                    <label>
                                        <input class="associated-cb" type="checkbox"/>
                                        &nbsp;
                                        <th:block th:text="${associated.getName()}"></th:block>
                                    </label>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <a th:if="${#lists.isEmpty(associatedProjects)}"
                   th:href="@{/projects/{id}/associated/edit(id=${project.getId()})}" class="btn btn-default btn-sm">
                    <fa:icon type="create"/>
                    &nbsp;
                    <th:block th:text="#{project.samples.nav.associated-create}"></th:block>
                </a>
                <div style="display: inline-block;" ng-controller="ToolsController as toolsCtrl">
                    <div style="display: inline-block;" uib-dropdown="" >
                        <button id="sample-tools" class="btn btn-default btn-sm" uib-dropdown-toggle="" type="button">
                        <th:block th:text="#{project.samples.nav.sample-tools}"></th:block>&nbsp;
                        <fa:icon type="caret-down" fixed="fixed"/>
                    </button>
                    <ul id="sample-tools-dropdown" class="dropdown-menu" uib-dropdown-menu="" role="menu">
                        <li ng-class="{disabled: toolsCtrl.disabled.lessThanTwo}">
                            <a id="mergeBtn" href="#" ng-click="toolsCtrl.merge()">
                                <fa:icon type="merge" fixed="true"/>&nbsp;
                                <th:block th:text="#{project.samples.nav.merge}">Merge</th:block>
                            </a>
                        </li>
                        <li ng-class="{disabled: toolsCtrl.disabled.lessThanOne}">
                            <a id="copyBtn" href="#" ng-click="toolsCtrl.copy()">
                                <fa:icon type="copy" fixed="true"/>&nbsp;
                                <th:block th:text="#{project.samples.nav.copy}">_COPY_</th:block>
                            </a>
                        </li>
                        <li ng-class="{disabled: toolsCtrl.disabled.lessThanOne}">
                            <a id="moveBtn" href="#" ng-click="toolsCtrl.move()">
                                <fa:icon type="move" fixed="true"/>&nbsp;
                                <th:block th:text="#{project.samples.nav.move}">_MOVE_</th:block>
                            </a>
                        </li>
                        <li ng-class="{disabled: toolsCtrl.disabled.lessThanOne}">
                            <a id="removeBtn" href="#" ng-click="toolsCtrl.remove()">
                                <fa:icon type="delete" fixed="true"/>&nbsp;
                                <th:block th:text="#{project.samples.nav.remove}">_MOVE_</th:block>
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a th:href="@{/projects/{id}/samples/new(id=${project.getId()})}" th:text="#{project.samples.nav.new}">Create New Sample</a></li>
                    </ul>
                    </div>
                    <div style="display: inline-block;" uib-dropdown="">
                        <button id="export-samples-btn" class="btn btn-default btn-sm" uib-dropdown-toggle="">
                            <th:block th:text="#{project.samples.export.label}" />&nbsp;
                            <fa:icon type="caret-down" fixed="fixed"/>
                        </button>
                        <ul class="dropdown-menu" uib-dropdown-menu="" role="menu" aria-labelledby="export-samples-btn">
                            <li role="menuitem" ng-class="{disabled: toolsCtrl.disabled.lessThanOne}">
                                <a href="#" ng-click="toolsCtrl.download()"><fa:icon type="download" />&nbsp;<th:block th:text="#{project.samples.export.download}"/></a></li>
                            <li th:if="${linkerAvailable}" role="menuitem">
                                <a href="#" ng-click="toolsCtrl.linker()"><fa:icon type="terminal" />&nbsp;<th:block th:text="#{project.samples.export.linker}"/></a>
                            </li>
                            <li role="menuitem" ng-class="{disabled: toolsCtrl.disabled.lessThanOne}">
                                <a href="#" ng-click="toolsCtrl.ncbiExport()"><fa:icon type="upload" />&nbsp;<th:block th:text="#{project.samples.export.ncbi}"/></a>
                            </li>
                        </ul>
                    </div>
                    <button id="cart-add-btn" class="btn btn-primary btn-sm" ng-click="toolsCtrl.addToCart()">
                        <fa:icon type="cart-plus"/>
                        &nbsp;
                        <th:block th:text="#{project.samples.nav.add-to-cart}">Add To Cart</th:block>
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>
</body>

<th:block layout:fragment="scripts">
    <script type="text/ng-template" id="filterButtons.html">
        <div th:replace="projects/partials/samples.tmpl :: filterButtons"></div>
    </script>

    <script id="filter.modal.html" type="text/ng-template">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.sample.filter-title}">[Filter Samples]</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="name" th:text="#{project.sample.filter-name}">Name</label>
                <input type="text" class="form-control" id="name" ng-model="filterCtrl.filter.name"/>
            </div>
            <div class="form-group">
                <label for="daterange" th:text="#{project.sample.filter-date}">Date</label>
                <input id="daterange" type="text" date-range-picker="" class="form-control date-picker" options="filterCtrl.options" ng-model="filterCtrl.filter.date"/>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="filterCtrl.cancel()" th:text="#{form.btn.cancel}">Cancel</button>
            <button id="doFilterBtn" class="btn btn-primary" ng-click="filterCtrl.doFilter()" th:text="#{table.filter.openBtn}">Filter</button>
        </div>
    </script>

    <script id="associated-projects.modal.html" type="text/ng-template" th:inline="javascript">
        <div class="modal-header">
            <h3 class="modal-title" th:text="#{project.samples.associated.modal.title}">Projects to include in
                table</h3>
        </div>
        <div class="modal-body">
            <h4 th:text="#{project.samples.associated.modal.local}">Local Associated Projects</h4>
            <table class="associated-projects-table" width="100%">
                <tr ng-class="associatedProjectsCtrl.display.project ? 'selected' : ''"
                    ng-click="associatedProjectsCtrl.display.project = !associatedProjectsCtrl.display.project">
                    <td width="300px">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" ng-model="associatedProjectsCtrl.display.project"/>&nbsp;
                                <th:block th:text="${project.label}"></th:block>
                            </label>
                        </div>
                    </td>
                    <td th:text="${project.organism}"></td>
                    <td><span class="label label-info" th:text="#{project.samples.associated.modal.current-project}">Current Project</span>
                    </td>
                </tr>
                <tr ng-class="project.selected ? 'selected' : ''"
                    ng-repeat="project in associatedProjectsCtrl.projects.local"
                    ng-click="project.selected = !project.selected; associatedProjectsCtrl.rowClick($event)">
                    <td>
                        <div class="checkbox"><label>
                            <input type="checkbox" ng-model="project.selected"/>&nbsp;{{project.getName()}}
                        </label></div>
                    </td>
                    <td ng-bind="project.getOrganism()"></td>
                    <td></td>
                </tr>
            </table>
            <strong ng-hide="associatedProjectsCtrl.projects.local">
                <fa:icon type="loading" fixed="true"/>
                &nbsp;
                <th:block th:text="#{project.samples.associated.modal.fetching-local}"></th:block>
            </strong>
            <div class="alert alert-info" ng-show="associatedProjectsCtrl.projects.local.length === 0">
                <strong th:text="#{project.samples.associated.modal.no-local}">No Locally Associated Projects</strong>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="associatedProjectsCtrl.close()" th:text="#{form.btn.cancel}">
                [Cancel]
            </button>
            <button class="btn btn-primary" ng-click="associatedProjectsCtrl.showProjects()"
                    th:text="#{project.samples.associated.modal.selectBtn}">[Show Selected Projects]
            </button>
        </div>
    </script>

    <script type="text/ng-template" id="samplesUpdate.html" th:inline="javascript">
        <div>
            <strong th:text="#{project.samples.display.notification.title}">Displaying:</strong><br/>
            <ul>
                <li ng-repeat='item in items' th:text="#{project.samples.display.notification.item}"></li>
            </ul>
        </div>
    </script>

    <script type="text/ng-template" id="filter.html">
        <div style="display: inline-block; margin-left: 3px;">
            <div class="btn-group btn-group-sm">
                <button id="filterByPropertyBtn" data:uib-tooltip="#{project.samples.filter.label}" type="button"
                        class="btn btn-default" ng-click="filterCtrl.openFilterModal()">
                    <span class="fa fa-filter"></span>
                </button>
                <button class="btn btn-default" ng-click="filterCtrl.openFileSelect()"
                        data:uib-tooltip="#{project.sample.filterByFile.modal.title}"
                        tooltip-append-to-body="true">
                    <input type="file" style="display: none;" id="filter-file-input"
                           filter-by-file="filterCtrl.filterByFile($fileContent)"/>
                    <span class="fa fa-file-o"></span>
                </button>
                <!--<ul class="dropdown-menu" uib-dropdown-menu="" role="menu">-->
                <!--<li role="menuitem">-->
                <!--<input type="file" style="display: none;" id="filter-file-input"-->
                <!--filter-by-file="filterCtrl.filterByFile($fileContent)"/>-->
                <!--<a href="#" ng-click="filterCtrl.openFileSelect()">-->
                <!--<fa:icon type="file" fixed="fixed"/>-->
                <!--&nbsp;-->
                <!--<th:block th:text="#{project.sample.filterByFile.modal.title}"/>-->
                <!--</a>-->
                <!--</li>-->
                <!--</ul>-->
            </div>
            <button id="clearFilterBtn" class="btn btn-sm" th:text="#{form.btn.clear}" ng-click="filterCtrl.clearAll()">Clear</button>
        </div>
    </script>

    <script type="text/ng-template" id="filtered-tags.html">
        <div class="text-right">
            <span class="label label-default" ng-show="tags.tag.file" th:text="#{project.sample.filter-by-file}" ng-click="tags.close('file')"></span>
            <span class="label label-default" ng-show="tags.tag.name" ng-click="tags.close('name')"><th:block th:text="#{project.samples.filter.by-name}"/> : {{tags.tag.name}}</span>
            <span class="label label-default" ng-show="tags.tag.minDate" ng-click="tags.close('minDate')"><th:block th:text="#{project.samples.filter.by-minDate}"/> : {{tags.tag.minDate | date: 'mediumDate'}}</span>
            <span class="label label-default" ng-show="tags.tag.endDate" ng-click="tags.close('endDate')"><th:block th:text="#{project.samples.filter.by-endDate}"/> : {{tags.tag.endDate | date: 'mediumDate'}}</span>
        </div>
    </script>
</th:block>
</html>
