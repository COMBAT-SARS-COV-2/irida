<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="projects/_base">
<head>
	<title th:text="${project.label} + ' - ' + #{project.nav.samples}"></title>
	<link rel="stylesheet" th:href="@{/resources/bower_components/angular-busy/angular-busy.css}"
	      href="/resources/bower_components/angular-busy/angular-busy.css"/>
	<link rel="stylesheet" th:href="@{/resources/bower_components/angular-ui-select/dist/select.min.css}" href="/resources/bower_components/angular-ui-select/dist/select.min.css"/>
	<link rel="stylesheet" th:href="@{/resources/bower_components/select2/select2.css}" href="/resources/bower_components/select2/select2.css"/>
	<script>window.dependencies = ['Samples'];</script>
</head>
<body>
<main layout:fragment="main">
	<input id="projectId" type="hidden" th:value="${project.getId()}"/>

	<div class="row">
		<div class="col-md-12">
			<h1 role="heading" th:text="#{project.samples.h1(${project.label})}">__PAGE_TITLE__</h1>
		</div>
	</div>
	<div class="row" ng-controller="SubNavCtrl as subnav">
		<div class="col-md-9 mrgn-bttm-md">
			<div class="btn-toolbar">
				<button id="mergeBtn" class="btn btn-default btn-sm" ng-click="subnav.merge()" ng-disabled="subnav.count&lt;2"
				        th:utext="#{project.samples.nav.merge}" data:tooltip="#{project.samples.nav.merge-tooltip}" tooltip-placement="bottom">
					__MERGE__
				</button>
			</div>
		</div>
		<div class="well well-sm col-md-3">
			<strong th:text="#{project.samples.table.select-count}"></strong>
			<span class="badge badge-info pull-right" id="selected-count" ng-bind="subnav.count"></span>
		</div>
	</div>
	<div class="row" th:attr="cg-busy=#{cg-busy.base(#{cg-busy.samples.table}, @{/resources/bower_components/angular-busy/angular-busy.html})}">
		<div class="col-md-12" ng-controller="SamplesTableCtrl as table">
			<table id="samplesTable" class="table">
				<thead>
				<tr>
					<th></th>
					<th th:text="#{project.samples.table.name}">__NAME__</th>
					<th th:text="#{project.samples.table.organism}">__NAME__</th>
					<th th:text="#{project.samples.table.created}">__NAME__</th>
					<th th:text="#{project.samples.table.files}">__NAME__</th>
				</tr>
				</thead>
				<tbody>
				<tr class="sample-row" ng-class="{'selected': sample.selected}" ng-repeat-start="sample in table.samples">
					<td>
						<input ui-indeterminate="sample.indeterminate" class="sample-select" type="checkbox" ng-model="sample.selected"
						       ng-change="table.updateSample(sample)"/></td>
					<td class="sample-name" ng-bind="sample.name"></td>
					<td ng-bind="sample.organism"></td>
					<td ng-bind="sample.created | date:'medium'"></td>
					<td ng-if="sample.files.length==0" ng-bind="sample.files.length"></td>
					<td ng-if="sample.files.length>0">
						<button class="view-files btn btn-default btn-xs" aria-controls="details-row"
						        ng-init="table.open[sample.id] = table.open[sample.id] === undefined ? true : table.open[sample.id]"
						        ng-click="table.open[sample.id] = !table.open[sample.id]">{{sample.files.length}}&nbsp;<span
								class="caret"></span></button>
					</td>
				</tr>
				<tr class="details-row" ng-repeat-end="" ng-if="sample.files.length>0">
					<td colspan="5">
						<div collapse="table.open[sample.id]">
							<ul class="list-group">
								<li class="file-item list-group-item" ng-class="{'selected': f.selected}" ng-repeat="f in sample.files">
									<input class="file-select" type="checkbox" ng-model="f.selected" ng-change="table.updateFile(sample, f)"/>
									<a class="btn btn-default btn-xs" href="#" th:attr="ng-href=@{'/sequenceFiles/{{f.id}}'}">{{f.name}}</a>
								</li>
							</ul>
						</div>
					</td>
				</tr>
				</tbody>
				<tfoot>
				<tr>
					<td colspan="4" class="text-center">
						<div pagination="" ng-controller="PagingCtrl as paging" ng-model="paging.page" items-per-page="paging.count"
						     total-items="paging.total" ng-change="paging.update()"></div>
					</td>
				</tr>
				</tfoot>
			</table>
		</div>
	</div>
</main>

<th:block layout:fragment="scripts" th:inline="javascript">
	<script th:src="@{/resources/bower_components/angular-busy/angular-busy.js}"
	        src="/resources/bower_components/angular-busy/angular-busy.js"></script>
	<script th:src="@{/resources/bower_components/angular-ui-select/dist/select.min.js}" src="/resources/bower_components/angular-ui-select/dist/select.min.js"></script>
	<script th:src="@{/resources/js/directives/datatables/irida-datatable.js}"
	        src="/resources/js/directives/datatables/irida-datatable.js"></script>
	<script th:src="@{/resources/js/pages/projects/samples.js}" src="/resources/js/pages/projects/samples.js"></script>
</th:block>
</body>
</html>
