<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="samples/_base">
<head lang="en">
	<meta charset="UTF-8"/>
	<title th:text="#{samples.files.title(${sample.label})}">THIS IS SOMETHING WRONG</title>
	<link rel="stylesheet" href="/resources/css/pages/sample_files.css"
	      th:href="@{/resources/css/pages/sample_files.css}"/>
	<script>window.dependencies = ['irida.sample.files'];</script>
	<style>
		.drop-box {
			width: 568px;
			height: 50px;
			border-radius: 4px;
			background-color: #fefefe;
			border: 2px dashed darkgreen;
			padding: 1rem;
			margin-bottom: 1rem;
			transition: background-color 0.5s ease;
		}

		.drop-box.dragover {
			background-color: #bbb;
		}

		.seq-file {
			display: flex;
			justify-content: center;
		}

		.seq-file_name {
			flex-grow: 2;
			overflow: hidden;
			white-space: nowrap;
		}

		.seq-file_size {
			width: 100px;
		}

		.seq-file_remove {
			width: 30px;
		}

	</style>
</head>
<body>
<main layout:fragment="main">
	<div class="row">
		<div class="col-md-12">
			<h1 id="page-title" role="heading">
				<th:block th:text="#{samples.files.page-title(${sample.getLabel()})}"></th:block>
				<file-upload></file-upload></h1>
		</div>
	</div>
	<div class="row" th:if="${fileDeleted}">
		<div class="col-md-12">
			<div id="file-deleted-success" th:if="${fileDeletedMessage}" class="alert alert-success"
			     role="alert">
				<strong th:text="${fileDeletedMessage}"></strong>
			</div>
			<div th:if="${fileDeletedError}" class="alert alert-error" role="alert">
				<strong th:text="${fileDeletedError}"></strong>
			</div>
		</div>
	</div>
	<upload-error></upload-error>
	<div class="row">
		<div class="col-md-12">
			<table class="table" th:with="dateFormat=#{locale.date.short}, url=@{${#httpServletRequest.requestURI}}"
			       ng-controller="FileController as fileCtrl">
				<th:block th:each="pair : ${paired_end}">
					<tr class="paired_end paired_end__forward" th:with="file=${pair.getForwardSequenceFile()}">
						<td th:replace="templates/_sequenceFile :: sequenceFileTableLayout (file=${file},icon='forward')"></td>
						<td>
							<div class="btn-group btn-group-sm pull-right" role="group">
								<button class="btn btn-default"
								        data:ng-click="${'fileCtrl.download(' + file.getId() + ')'}">
									<span class="fa fa-fw fa-download"></span>
								</button>
								<button th:if="${canManageSample}"
								        class="btn btn-default remove-file"
								        th:with="fId=${file.id + ', &#39;'' + file.getLabel() + ''&#39;'}"
								        data:ng-click="${'fileCtrl.deleteFile(' + fId + ')'}">
									<span class="fa fa-fw fa-trash"></span>
								</button>
							</div>
						</td>
					</tr>
					<tr class="paired_end paired_end__reverse" th:with="file=${pair.getReverseSequenceFile()}">
						<td th:replace="templates/_sequenceFile :: sequenceFileTableLayout (file=${file},icon='reverse')"></td>
						<td>
							<div class="btn-group btn-group-sm pull-right" role="group">
								<button class="btn btn-default"
								        data:ng-click="${'fileCtrl.download(' + file.getId() + ')'}">
									<span class="fa fa-fw fa-download"></span>
								</button>
								<button th:if="${canManageSample}"
								        class="btn btn-default remove-file"
								        th:with="fId=${file.id + ', &#39;'' + file.getLabel() + ''&#39;'}"
								        data:ng-click="${'fileCtrl.deleteFile(' + fId + ')'}">
									<span class="fa fa-fw fa-trash"></span>
								</button>
							</div>
						</td>
					</tr>
				</th:block>
				<tr class="single_end" th:each="join : ${single_end}" th:with="file=${join.getObject()}">
					<td th:replace="templates/_sequenceFile :: sequenceFileTableLayout (file=${file},icon='single')"></td>
					<td>
						<div class="btn-group btn-group-sm pull-right" role="group">
							<button class="btn btn-default"
							        data:ng-click="${'fileCtrl.download(' + file.getId() + ')'}">
								<span class="fa fa-fw fa-download"></span>
							</button>
							<button th:if="${canManageSample}"
							        class="btn btn-default remove-file"
							        th:with="fId=${file.id + ', &#39;'' + file.getLabel() + ''&#39;'}"
							        data:ng-click="${'fileCtrl.deleteFile(' + fId + ')'}">
								<span class="fa fa-fw fa-trash"></span>
							</button>
						</div>
					</td>
				</tr>
			</table>
		</div>
	</div>

</main>
<th:block layout:fragment="page-scripts" th:inline="javascript">
	<script type="text/ng-template" id="/upload-error.html">
		<div class="alert alert-warning" ng-show="errorCtrl.showError">
			<strong th:text="#{project.samples.files.upload.error.title}">__UPLOAD_ERROR__</strong>

			<p th:text="#{project.samples.files.upload.error.body}">__Upload_error_message__</p>
		</div>
	</script>
	<script type="text/ng-template" id="/upload.html">
		<div class="modal-header">
			<h3 class="modal-title" th:text="#{project.samples.files.upload}">I'm a modal!</h3>
		</div>
		<div class="modal-body">
			<div ngf-drop="" ngf-change="modalCtrl.addFiles($files, $event, $rejectedFiles)" class="drop-box"
			     ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"
			     ngf-accept="'.fastq,.fastq.gz'" th:text="#{samples.files.upload.upload-drop}">Drop directory of files here.</div>
			<div class="text-right select-files-btn">
				<button class="btn btn-default btn-sm" ngf-accept="'.fastq,.fastq.gz'" ngf-select="" ngf-multiple="true" ngf-change="modalCtrl.addFiles($files, $event, $rejectedFiles)" th:text="#{samples.files.upload.btn}">Or Select Files</button>
			</div>
			<ul class="list-group">
				<li class="list-group-item seq-file" ng-repeat="file in modalCtrl.files">
					<div class="seq-file_name"><span class="fa fa-fw fa-file-o"></span>&nbsp;{{file.name}}</div>
					<div class="seq-file_size">{{file.size | humanReadableBytes}}</div>
					<div class="seq-file_remove"><button type="button" class="btn btn-default btn-xs" data-dismiss="alert" aria-label="Remove" ng-click="modalCtrl.remove(file)"><span aria-hidden="true">&times;</span></button></div>
				</li>
			</ul>
			<div class="alert alert-warning" role="alert" ng-show="modalCtrl.rejects.length">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong th:text="#{samples.files.upload.reject}">Warning!</strong>
				<ul>
					<li ng-repeat="file in modalCtrl.rejects">{{file.name}}</li>
				</ul>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-warning" ng-click="modalCtrl.cancel()" th:text="#{form.btn.cancel}">Cancel</button>
			<button class="btn btn-primary" ng-disabled="modalCtrl.files.length===0" ng-click="modalCtrl.ok()"><span class="fa fa-fw fa-upload"></span>&nbsp;<th:block th:text="#{form.btn.upload}"></th:block></button>
		</div>
	</script>
	<script type="text/ng-template" id="/confirm.html">
		<form method="post" th:action="@{/samples/{sId}/files/delete(sId=${sampleId})}">
			<div class="modal-header">
			<h3 class="modal-title" th:text="#{samples.files.remove.confirmation}"></h3>
		</div>
		<div class="modal-body">
			<h4>{{ ::deleteCtrl.label }}</h4>
			<input type="hidden" name="fileId" value="{{ deleteCtrl.fileId }}"/> <input type="hidden" name="returnUrl" th:value="@{${#httpServletRequest.requestURI}}"/>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" ng-click="deleteCtrl.cancel()" th:text="#{form.btn.cancel}">Cancel</button>
			<button id="remove-file-confirm" type="submit" class="btn btn-warning remove-file-confirm" th:text="#{form.btn.remove}">OK</button>
		</div>
		</form>
	</script>
	<script th:inline="javascript">
		var PAGE = {
			sample: {
				id: /*[[${sample.getId()}]]*/ '1'
			}
		};
	</script>
	<script src="/resources/bower_components/ng-file-upload/ng-file-upload.min.js"
	        th:src="@{/resources/bower_components/ng-file-upload/ng-file-upload.min.js}"></script>
	<script src="/resources/js/pages/samples/files.js" th:src="@{/resources/js/pages/samples/files.js}"></script>
</th:block>
</body>
</html>
