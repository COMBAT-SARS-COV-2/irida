!function(){function e(e){e.cgPromise=null}function t(e){"use strict";var t=this;t.init=function(t,n){n=n||{};var c=e(function(){var o=$(t);o.length>0&&(o.select2(n),e.cancel(c))},50)}}function n(e,t,n){"use strict";function c(e){a(e.sample),i(e.count)}function o(e){return f.customPOST({sampleId:e.id},"cart/add/sample")}function r(e){return f.customPOST({sampleId:e.id},"cart/remove/sample")}function s(e,t){return f.customPOST({sampleId:e.id,fileId:t.id},"cart/add/file")}function l(e,t){return f.customPOST({sampleId:e.id,fileId:t.id},"cart/remove/file")}function a(e){var t=_.findKey(u.samples,{id:e.id});u.samples[t]=e}function i(t){e.$broadcast("COUNT",{count:t})}var u=this,m=e.projectId,p={page:0,sortDir:"desc",sortedBy:"createdDate",count:10},f=t.all("projects/"+m+"/ajax/samples");u.filter=_.clone(p),u.samples=[],u.getSamples=function(t){_.extend(u.filter,t||{}),e.cgPromise=f.customGET("",u.filter).then(function(t){angular.copy(t.samples,u.samples),e.$broadcast("PAGING_UPDATE",{total:t.totalSamples}),i(t.count)})},u.updateSample=function(e){var t=e.selected?o(e):r(e);t.then(function(e){c(e)})},u.updateFile=function(e,t){var n=t.selected?s(e,t):l(e,t);n.then(function(e){c(e)})},u.getSelectedSampleNames=function(){return f.get("cart/names").then(function(e){return e.samples})},u.merge=function(e){return f.customPOST(e,"merge").then(function(e){"success"===e.result&&(u.getSamples({}),n.show({type:e.result,msg:e.message}))})}}function c(e,t){"use strict";var n=this;n.count=10,n.total=0,n.page=1,n.update=function(){t.getSamples({page:n.page-1,count:n.count})},e.$on("PAGING_UPDATE",function(e,t){n.total=t.total})}function o(e){"use strict";var t=this;t.open=[],t.samples=e.samples,t.updateSample=function(t){e.updateSample(t)},t.updateFile=function(t,n){e.updateFile(t,n)},e.getSamples({})}function r(e,t,n,c){"use strict";var o=this;o.count=0,o.merge=function(){t.open({templateUrl:n+"projects/templates/merge",controller:"MergeCtrl as mergeCtrl",resolve:{samples:function(){return c.getSelectedSampleNames()}}})},o.openModal=function(e){t.open({templateUrl:n+"projects/templates/"+e,controller:"CopyMoveCtrl as cmCtrl",resolve:{samples:function(){return c.getSelectedSampleNames()},type:function(){return e}}})},e.$on("COUNT",function(e,t){o.count=t.count})}function s(e,t,n,c,o){"use strict";var r=this;r.samples=o,r.selected=o[0],r.name="",r.error={},n.init("#samplesSelect"),r.close=function(){t.close()},r.merge=function(){c.merge({mergeSampleId:r.selected.id,newName:r.name}).then(function(){r.close()})},e.$watch(function(){return r.name},_.debounce(function(t,n){t!==n&&(r.error.length=t.length<5&&t.length>0,r.error.format=-1!==t.indexOf(" ")),e.$apply()},300))}function l(e,t,n,c,o,r){"use strict";var s=this;s.samples=o,s.close=function(){e.close()},s.go=function(){n[r](s.selected).then(function(){s.close()})},c.init("#projectsSelect",{minimumLength:2,ajax:{url:t+"projects/ajax/samples/available_projects",dataType:"json",quietMillis:250,data:function(e,t){return{term:e,page:t-1,pageSize:10}},results:function(e,t){var n=[],c=10*t<e.total;return _.forEach(e.projects,function(e){n.push({id:e.id,text:e.text||e.name})}),{results:n,more:c}}}})}angular.module("Samples",["ui.select","cgBusy"]).run(["$rootScope",e]).service("Select2Service",["$timeout",t]).service("SamplesService",["$rootScope","Restangular","notifications",n]).controller("SubNavCtrl",["$scope","$modal","BASE_URL","SamplesService",r]).controller("PagingCtrl",["$scope","SamplesService",c]).controller("SamplesTableCtrl",["SamplesService",o]).controller("MergeCtrl",["$scope","$modalInstance","Select2Service","SamplesService","samples",s]).controller("CopyMoveCtrl",["$modalInstance","BASE_URL","SamplesService","Select2Service","samples","type",l])}();