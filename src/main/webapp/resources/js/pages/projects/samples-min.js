function setRootVariable(e){e.cgPromise=null}function SamplesService(e,t,n){"use strict";function a(e){c(e.sample),u(e.count)}function l(e){return d.customPOST({sampleId:e.id},"cart/add/sample")}function r(e){return d.customPOST({sampleId:e.id},"cart/remove/sample")}function o(e,t){return d.customPOST({sampleId:e.id,fileId:t.id},"cart/add/file")}function s(e,t){return d.customPOST({sampleId:e.id,fileId:t.id},"cart/remove/file")}function c(e){var t=_.findKey(i.samples,{id:e.id});i.samples[t]=e}function u(t){e.$broadcast("COUNT",{count:t})}var i=this,m=angular.element("#projectId").val(),p={page:0,sortDir:"desc",sortedBy:"createdDate",count:10},d=t.all("projects/"+m+"/ajax/samples");i.filter=_.clone(p),i.samples=[],i.getSamples=function(t){_.extend(i.filter,t||{}),e.cgPromise=d.customGET("",i.filter).then(function(t){angular.copy(t.samples,i.samples),e.$broadcast("PAGING_UPDATE",{total:t.totalSamples}),u(t.count)})},i.updateSample=function(e){var t=e.selected?l(e):r(e);t.then(function(e){a(e)})},i.updateFile=function(e,t){var n=t.selected?o(e,t):s(e,t);n.then(function(e){a(e)})},i.getSelectedSampleNames=function(){return d.get("cart/names").then(function(e){return e.samples})},i.merge=function(e){return d.customPOST(e,"merge").then(function(e){"success"===e.result&&(i.getSamples({}),n.show({type:e.result,msg:e.message}))})}}function PagingCtrl(e,t){"use strict";var n=this;n.count=10,n.total=0,n.page=1,n.update=function(){t.getSamples({page:n.page-1,count:n.count})},e.$on("PAGING_UPDATE",function(e,t){n.total=t.total})}function SamplesTableCtrl(e){"use strict";var t=this;t.open=[],t.samples=e.samples,t.updateSample=function(t){e.updateSample(t)},t.updateFile=function(t,n){e.updateFile(t,n)},e.getSamples({})}function SubNavCtrl(e,t,n,a){"use strict";var l=this;l.count=0,l.merge=function(){t.open({templateUrl:n+"projects/templates/merge",controller:"MergeCtrl as mergeCtrl",resolve:{samples:function(){return a.getSelectedSampleNames()}}})},e.$on("COUNT",function(e,t){l.count=t.count})}function MergeCtrl(e,t,n,a){"use strict";var l=this;l.samples=a,l.selected=a[0],l.name="",l.error={},l.close=function(){t.close()},l.merge=function(){n.merge({mergeSampleId:l.selected.id,newName:l.name}).then(function(){l.close()})},e.$watch(function(){return l.name},_.debounce(function(t,n){t!==n&&(l.error.length=t.length<5&&t.length>0,l.error.format=-1!==t.indexOf(" "),console.log(-1!==t.indexOf(" "))),e.$apply()},300))}angular.module("Samples",["ui.select","cgBusy"]).run(["$rootScope",setRootVariable]).service("SamplesService",["$rootScope","Restangular","notifications",SamplesService]).controller("SubNavCtrl",["$scope","$modal","BASE_URL","SamplesService",SubNavCtrl]).controller("PagingCtrl",["$scope","SamplesService",PagingCtrl]).controller("SamplesTableCtrl",["SamplesService",SamplesTableCtrl]).controller("MergeCtrl",["$scope","$modalInstance","SamplesService","samples",MergeCtrl]);