!function(){function e(e){e.cgPromise=null}function t(e,t,n){"use strict";function o(e){l(e.sample),u(e.count)}function c(e){return f.customPOST({sampleId:e.id},"cart/add/sample")}function a(e){return f.customPOST({sampleId:e.id},"cart/remove/sample")}function r(e,t){return f.customPOST({sampleId:e.id,fileId:t.id},"cart/add/file")}function s(e,t){return f.customPOST({sampleId:e.id,fileId:t.id},"cart/remove/file")}function l(e){var t=_.findKey(i.samples,{id:e.id});i.samples[t]=e}function u(t){e.$broadcast("COUNT",{count:t})}var i=this,m=e.projectId,p={page:0,sortDir:"desc",sortedBy:"createdDate",count:10},f=t.all("projects/"+m+"/ajax/samples");i.filter=_.clone(p),i.samples=[],i.getSamples=function(t){_.extend(i.filter,t||{}),e.cgPromise=f.customGET("",i.filter).then(function(t){angular.copy(t.samples,i.samples),e.$broadcast("PAGING_UPDATE",{total:t.totalSamples}),u(t.count)})},i.updateSample=function(e){var t=e.selected?c(e):a(e);t.then(function(e){o(e)})},i.updateFile=function(e,t){var n=t.selected?r(e,t):s(e,t);n.then(function(e){o(e)})},i.getSelectedSampleNames=function(){return f.get("cart/names").then(function(e){return e.samples})},i.merge=function(e){return f.customPOST(e,"merge").then(function(e){"success"===e.result&&(i.getSamples({}),n.show({type:e.result,msg:e.message}))})}}function n(e,t){"use strict";var n=this;n.count=10,n.total=0,n.page=1,n.update=function(){t.getSamples({page:n.page-1,count:n.count})},e.$on("PAGING_UPDATE",function(e,t){n.total=t.total})}function o(e){"use strict";var t=this;t.open=[],t.samples=e.samples,t.updateSample=function(t){e.updateSample(t)},t.updateFile=function(t,n){e.updateFile(t,n)},e.getSamples({})}function c(e,t,n,o){"use strict";var c=this;c.count=0,c.merge=function(){t.open({templateUrl:n+"projects/templates/merge",controller:"MergeCtrl as mergeCtrl",resolve:{samples:function(){return o.getSelectedSampleNames()}}})},e.$on("COUNT",function(e,t){c.count=t.count})}function a(e,t,n,o){"use strict";var c=this;c.samples=o,c.selected=o[0],c.name="",c.error={},c.close=function(){t.close()},c.merge=function(){n.merge({mergeSampleId:c.selected.id,newName:c.name}).then(function(){c.close()})},e.$watch(function(){return c.name},_.debounce(function(t,n){t!==n&&(c.error.length=t.length<5&&t.length>0,c.error.format=-1!==t.indexOf(" ")),e.$apply()},300))}angular.module("Samples",["ui.select","cgBusy"]).run(["$rootScope",e]).service("SamplesService",["$rootScope","Restangular","notifications",t]).controller("SubNavCtrl",["$scope","$modal","BASE_URL","SamplesService",c]).controller("PagingCtrl",["$scope","SamplesService",n]).controller("SamplesTableCtrl",["SamplesService",o]).controller("MergeCtrl",["$scope","$modalInstance","SamplesService","samples",a])}();